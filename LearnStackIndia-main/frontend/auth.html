<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DSA Visualizer - Login & Sign Up</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#2563eb',
                        secondary: '#64748b',
                        accent: '#f59e0b',
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'glow': 'glow 2s ease-in-out infinite alternate',
                        'slide-in-left': 'slideInLeft 0.8s ease-out',
                        'slide-in-right': 'slideInRight 0.8s ease-out',
                        'fade-in-up': 'fadeInUp 0.6s ease-out',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0px)' },
                            '50%': { transform: 'translateY(-20px)' },
                        },
                        glow: {
                            '0%': { boxShadow: '0 0 20px linear-gradient(135deg, #667eea 0%, #764ba2 70%, #f093fb 100%)' },
                            '100%': { boxShadow: '0 0 30px linear-gradient(135deg, #667eea 0%, #764ba2 70%, #f093fb 100%)' },
                        },

                        slideInLeft: {
                            '0%': { transform: 'translateX(-100%)', opacity: '0' },
                            '100%': { transform: 'translateX(0)', opacity: '1' },
                        },
                        slideInRight: {
                            '0%': { transform: 'translateX(100%)', opacity: '0' },
                            '100%': { transform: 'translateX(0)', opacity: '1' },
                        },
                        fadeInUp: {
                            '0%': { transform: 'translateY(30px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                    }
                }
            }
        }
    </script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
        }

        @keyframes gradientShift {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }


        .glass-effect {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .myBox::before {
            content: "";
            position: absolute;
            top: -15px;
            left: -15px;
            right: -15px;
            bottom: -15px;
            border-radius: inherit;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            background-size: 400% 400%;
            animation: gradientShifter 15s ease infinite;
            filter: blur(25px);
            /* makes it glow like shadow */
            z-index: -1;
        }

        @keyframes gradientShifter {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        .dark .glass-effect {
            background: rgba(17, 24, 39, 0.15);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(75, 85, 99, 0.3);
        }

        .floating-shapes {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
            pointer-events: none;
        }

        .shape {
            position: absolute;
            opacity: 0.1;
            animation: float 6s ease-in-out infinite;
        }

        .shape:nth-child(1) {
            top: 10%;
            left: 10%;
            animation-delay: 0s;
        }

        .shape:nth-child(2) {
            top: 20%;
            right: 10%;
            animation-delay: 2s;
        }

        .shape:nth-child(3) {
            bottom: 20%;
            left: 15%;
            animation-delay: 4s;
        }

        .shape:nth-child(4) {
            bottom: 10%;
            right: 15%;
            animation-delay: 1s;
        }

        .input-glow:focus {
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
            border-color: #3b82f6;
        }

        .dark .input-glow:focus {
            box-shadow: 0 0 0 3px rgba(147, 197, 253, 0.3);
            border-color: #93c5fd;
        }

        .otp-input {
            width: 50px;
            height: 50px;
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            margin: 0 5px;
            transition: all 0.3s ease;
        }

        .otp-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
            transform: scale(1.05);
        }

        .dark .otp-input {
            background-color: #374151;
            border-color: #4b5563;
            color: white;
        }

        .dark .otp-input:focus {
            border-color: #93c5fd;
            box-shadow: 0 0 0 3px rgba(147, 197, 253, 0.2);
        }

        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #2563eb, #1e40af);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3);
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>

<body class="bg-gray-50 dark:bg-gray-900 transition-colors duration-300 overflow-x-hidden">
    <!-- Animated Background -->
    <div class="fixed inset-0 gradient-bg"></div>

    <!-- Floating Shapes -->
    <div class="floating-shapes">
        <div class="shape w-32 h-32 bg-white rounded-full"></div>
        <div class="shape w-24 h-24 bg-blue-200 rounded-lg transform rotate-45"></div>
        <div class="shape w-20 h-20 bg-purple-200 rounded-full"></div>
        <div class="shape w-28 h-28 bg-pink-200 rounded-lg transform rotate-12"></div>
    </div>

    <div class="relative min-h-screen flex">
        <!-- Left Side - Branding -->
        <div class=" lg:flex lg:w-1/2 items-center justify-center p-8 animate-slide-in-left">
            <div class="max-w-lg text-center">
                <!-- Theme Toggle -->
                <div class="absolute top-8 left-8">
                    <button id="themeToggle"
                        class="glass-effect p-3 rounded-full text-white hover:bg-white/20 transition-all duration-300">
                        <i id="themeIcon" class="fas fa-moon text-xl"></i>
                    </button>
                </div>

                <div class="animate-float">
                    <div class="glass-effect p-8 rounded-2xl animate-fade-in-up myBox">
                        <i class="fas fa-code text-6xl text-white mb-4 block"></i>
                        <h1 class="text-4xl font-bold text-white mb-4">
                            DSA Visualizer
                        </h1>
                        <p class="text-xl text-white/90">
                            Master Data Structures & Algorithms with Interactive Visualizations
                        </p>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4 mt-8">
                    <div
                        class="glass-effect p-4 rounded-xl text-sm font-semibold text-gray-700 dark:text-gray-300 text-center">
                        <i class="fas fa-search text-2xl mb-2 block text-blue-200"></i>
                        <span class="text-sm">Searching</span>
                    </div>
                    <div
                        class="glass-effect p-4 rounded-xl text-sm font-semibold text-gray-700 dark:text-gray-300 text-center">
                        <i class="fas fa-sort-amount-up text-2xl mb-2 block text-green-200"></i>
                        <span class="text-sm">Sorting</span>
                    </div>
                    <div
                        class="glass-effect p-4 rounded-xl text-sm font-semibold text-gray-700 dark:text-gray-300 text-center">
                        <i class="fas fa-sitemap text-2xl mb-2 block text-purple-200"></i>
                        <span class="text-sm">Trees</span>
                    </div>
                    <div
                        class="glass-effect p-4 rounded-xl text-sm font-semibold text-gray-700 dark:text-gray-300 text-center">
                        <i class="fas fa-project-diagram text-2xl mb-2 block text-pink-200"></i>
                        <span class="text-sm">Graphs</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Side - Authentication Forms -->
        <div class="w-full lg:w-1/2 flex items-center justify-center p-8 animate-slide-in-right">
            <div class="w-full max-w-md">
                <!-- Mobile Theme Toggle -->
                <div class="lg:hidden text-center mb-8">
                    <button id="mobileThemeToggle"
                        class="glass-effect p-3 rounded-full text-white hover:bg-white/20 transition-all duration-300">
                        <i id="mobileThemeIcon" class="fas fa-moon text-xl"></i>
                    </button>
                </div>

                <!-- Login Form -->
                <div id="loginForm" class="glass-effect p-8 rounded-2xl animate-fade-in-up">
                    <div class="text-center mb-8">
                        <div class="lg:hidden mb-4">
                            <i class="fas fa-code text-4xl text-blue-600 dark:text-blue-400 mb-2 block"></i>
                            <h2 class="text-2xl font-bold text-gray-800 dark:text-white">DSA Visualizer</h2>
                        </div>
                        <h3 class="text-3xl font-bold text-gray-800 dark:text-white mb-2">Welcome Back!</h3>
                        <p class="text-gray-600 dark:text-gray-300">Sign in to continue your learning journey</p>
                    </div>

                    <form id="loginFormSubmit" class="space-y-6">
                        <div>
                            <label for="loginEmail"
                                class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                                <i class="fas fa-envelope mr-2"></i>Email Address
                            </label>
                            <input type="email" id="loginEmail" name="email" required
                                class="input-glow w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl focus:outline-none transition-all duration-300 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                                placeholder="Enter your email">
                        </div>

                        <div>
                            <label for="loginPassword"
                                class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                                <i class="fas fa-lock mr-2"></i>Password
                            </label>
                            <input type="password" id="loginPassword" name="password" required
                                class="input-glow w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl focus:outline-none transition-all duration-300 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                                placeholder="Enter your password">
                        </div>

                        <div id="loginError"
                            class="hidden bg-red-100 dark:bg-red-900 border border-red-400 dark:border-red-600 text-red-700 dark:text-red-300 px-4 py-3 rounded-xl">
                        </div>

                        <button type="submit" id="loginSubmit"
                            class="btn-primary w-full text-white py-3 rounded-xl font-semibold text-lg">
                            <span id="loginButtonText">
                                <i class="fas fa-sign-in-alt mr-2"></i>Sign In
                            </span>
                            <span id="loginButtonSpinner" class="hidden">
                                <div class="loading-spinner inline-block mr-2"></div>
                                Signing in...
                            </span>
                        </button>
                    </form>

                    <div class="mt-6 text-center">
                        <button id="forgotPasswordBtn"
                            class="text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 font-semibold transition-colors duration-300">
                            Forgot your password?
                        </button>
                    </div>

                    <div class="mt-8 text-center">
                        <span class="text-gray-600 dark:text-gray-400">Don't have an account? </span>
                        <button id="switchToRegister"
                            class="text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 font-semibold transition-colors duration-300">Create
                            one</button>
                    </div>
                </div>

                <!-- Register Form -->
                <div id="registerForm" class="glass-effect p-8 rounded-2xl animate-fade-in-up hidden">
                    <div class="text-center mb-8">
                        <div class="lg:hidden mb-4">
                            <i class="fas fa-code text-4xl text-blue-600 dark:text-blue-400 mb-2 block"></i>
                            <h2 class="text-2xl font-bold text-gray-800 dark:text-white">DSA Visualizer</h2>
                        </div>
                        <h3 class="text-3xl font-bold text-gray-800 dark:text-white mb-2">Join Us Today!</h3>
                        <p class="text-gray-600 dark:text-gray-300">Create an account to start mastering DSA</p>
                    </div>

                    <form id="registerFormSubmit" class="space-y-6">
                        <div>
                            <label for="registerUsername"
                                class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                                <i class="fas fa-user mr-2"></i>Username
                            </label>
                            <input type="text" id="registerUsername" name="username" required
                                class="input-glow w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl focus:outline-none transition-all duration-300 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                                placeholder="Choose a username">
                        </div>

                        <div>
                            <label for="registerEmail"
                                class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                                <i class="fas fa-envelope mr-2"></i>Email Address
                            </label>
                            <input type="email" id="registerEmail" name="email" required
                                class="input-glow w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl focus:outline-none transition-all duration-300 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                                placeholder="Enter your email">
                        </div>

                        <div>
                            <label for="registerPassword"
                                class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                                <i class="fas fa-lock mr-2"></i>Password
                            </label>
                            <input type="password" id="registerPassword" name="password" required
                                class="input-glow w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl focus:outline-none transition-all duration-300 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                                placeholder="Create a secure password">
                        </div>

                        <div id="registerError"
                            class="hidden bg-red-100 dark:bg-red-900 border border-red-400 dark:border-red-600 text-red-700 dark:text-red-300 px-4 py-3 rounded-xl">
                        </div>

                        <button type="submit" id="registerSubmit"
                            class="btn-primary w-full text-white py-3 rounded-xl font-semibold text-lg">
                            <span id="registerButtonText">
                                <i class="fas fa-user-plus mr-2"></i>Create Account
                            </span>
                            <span id="registerButtonSpinner" class="hidden">
                                <div class="loading-spinner inline-block mr-2"></div>
                                Creating account...
                            </span>
                        </button>
                    </form>

                    <div class="mt-8 text-center">
                        <span class="text-gray-600 dark:text-gray-400">Already have an account? </span>
                        <button id="switchToLogin"
                            class="text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 font-semibold transition-colors duration-300">Sign
                            in</button>
                    </div>
                </div>

                <!-- OTP Verification -->
                <div id="otpModal" class="glass-effect p-8 rounded-2xl animate-fade-in-up hidden">
                    <div class="text-center mb-8">
                        <div
                            class="mx-auto h-20 w-20 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center mb-4">
                            <i class="fas fa-envelope-open-text text-3xl text-blue-600 dark:text-blue-400"></i>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-800 dark:text-white mb-2">Verify Your Email</h3>
                        <p class="text-gray-600 dark:text-gray-300 mb-2">
                            We've sent a 6-digit code to
                        </p>
                        <p class="font-semibold text-blue-600 dark:text-blue-400" id="otpEmailDisplay"></p>
                    </div>

                    <form id="otpFormSubmit" class="space-y-6">
                        <div>
                            <label
                                class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4 text-center">Enter
                                verification code</label>
                            <div class="flex justify-center space-x-2">
                                <input type="text" maxlength="1" class="otp-input" data-index="0">
                                <input type="text" maxlength="1" class="otp-input" data-index="1">
                                <input type="text" maxlength="1" class="otp-input" data-index="2">
                                <input type="text" maxlength="1" class="otp-input" data-index="3">
                                <input type="text" maxlength="1" class="otp-input" data-index="4">
                                <input type="text" maxlength="1" class="otp-input" data-index="5">
                            </div>
                        </div>

                        <div id="otpError"
                            class="hidden bg-red-100 dark:bg-red-900 border border-red-400 dark:border-red-600 text-red-700 dark:text-red-300 px-4 py-3 rounded-xl text-center">
                        </div>

                        <button type="submit" id="otpSubmit"
                            class="btn-primary w-full text-white py-3 rounded-xl font-semibold text-lg">
                            <span id="otpButtonText">
                                <i class="fas fa-check-circle mr-2"></i>Verify Email
                            </span>
                            <span id="otpButtonSpinner" class="hidden">
                                <div class="loading-spinner inline-block mr-2"></div>
                                Verifying...
                            </span>
                        </button>
                    </form>

                    <div class="mt-6 text-center">
                        <p class="text-gray-600 dark:text-gray-400 mb-3">Didn't receive the code?</p>
                        <button id="resendOtp"
                            class="text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 font-semibold transition-colors duration-300">
                            <span id="resendOtpText">
                                <i class="fas fa-redo mr-2"></i>Resend Code
                            </span>
                            <span id="resendOtpSpinner" class="hidden">
                                <div class="loading-spinner inline-block mr-2"></div>
                                Sending...
                            </span>
                        </button>
                    </div>
                </div>

                <!-- Success Message -->
                <div id="successMessage" class="glass-effect p-8 rounded-2xl animate-fade-in-up hidden text-center">
                    <div
                        class="mx-auto h-20 w-20 bg-green-100 dark:bg-green-900 rounded-full flex items-center justify-center mb-6">
                        <i class="fas fa-check-circle text-3xl text-green-600 dark:text-green-400"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800 dark:text-white mb-4">Welcome to DSA Visualizer!</h3>
                    <p class="text-gray-600 dark:text-gray-300 mb-6">
                        Your account has been verified successfully. Redirecting to the main application...
                    </p>
                    <div class="loading-spinner mx-auto"></div>
                </div>

                <!-- Forgot Password Form -->
                <div id="forgotPasswordForm" class="glass-effect p-8 rounded-2xl animate-fade-in-up hidden">
                    <div class="text-center mb-8">
                        <div
                            class="mx-auto h-20 w-20 bg-red-100 dark:bg-red-900 rounded-full flex items-center justify-center mb-4">
                            <i class="fas fa-key text-3xl text-red-600 dark:text-red-400"></i>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-800 dark:text-white mb-2">Reset Password</h3>
                        <p class="text-gray-600 dark:text-gray-300">
                            Enter your email address to reset your password
                        </p>
                    </div>

                    <form id="forgotPasswordFormSubmit" class="space-y-6">
                        <div>
                            <label for="forgotPasswordEmail"
                                class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                                <i class="fas fa-envelope mr-2"></i>Email Address
                            </label>
                            <input type="email" id="forgotPasswordEmail" name="email" required
                                class="input-glow w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl focus:outline-none transition-all duration-300 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                                placeholder="Enter your email">
                        </div>

                        <div id="forgotPasswordError"
                            class="hidden bg-red-100 dark:bg-red-900 border border-red-400 dark:border-red-600 text-red-700 dark:text-red-300 px-4 py-3 rounded-xl">
                        </div>
                        <div id="forgotPasswordSuccess"
                            class="hidden bg-green-100 dark:bg-green-900 border border-green-400 dark:border-green-600 text-green-700 dark:text-green-300 px-4 py-3 rounded-xl">
                        </div>

                        <button type="submit" id="forgotPasswordSubmit"
                            class="btn-primary w-full text-white py-3 rounded-xl font-semibold text-lg">
                            <span id="forgotPasswordButtonText">
                                <i class="fas fa-paper-plane mr-2"></i>Send Reset Code
                            </span>
                            <span id="forgotPasswordButtonSpinner" class="hidden">
                                <div class="loading-spinner inline-block mr-2"></div>
                                Sending...
                            </span>
                        </button>
                    </form>

                    <div class="mt-6 text-center">
                        <button id="backToLogin"
                            class="text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 font-semibold transition-colors duration-300">
                            <i class="fas fa-arrow-left mr-1"></i>
                            Back to Login
                        </button>
                    </div>
                </div>

                <!-- Password Reset OTP Modal (NEW) -->
                <div id="passwordResetOtpModal" class="glass-effect p-8 rounded-2xl animate-fade-in-up hidden">
                    <div class="text-center mb-8">
                        <div
                            class="mx-auto h-20 w-20 bg-red-100 dark:bg-red-900 rounded-full flex items-center justify-center mb-4">
                            <i class="fas fa-shield-alt text-3xl text-red-600 dark:text-red-400"></i>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-800 dark:text-white mb-2">Enter Reset Code</h3>
                        <p class="text-gray-600 dark:text-gray-300 mb-2">
                            We've sent a 6-digit code to
                        </p>
                        <p class="font-semibold text-red-600 dark:text-red-400" id="resetOtpEmailDisplay"></p>
                    </div>

                    <form id="passwordResetOtpFormSubmit" class="space-y-6">
                        <div>
                            <label
                                class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4 text-center">Enter
                                reset code</label>
                            <div class="flex justify-center space-x-2">
                                <input type="text" maxlength="1" class="otp-input reset-otp-input" data-index="0">
                                <input type="text" maxlength="1" class="otp-input reset-otp-input" data-index="1">
                                <input type="text" maxlength="1" class="otp-input reset-otp-input" data-index="2">
                                <input type="text" maxlength="1" class="otp-input reset-otp-input" data-index="3">
                                <input type="text" maxlength="1" class="otp-input reset-otp-input" data-index="4">
                                <input type="text" maxlength="1" class="otp-input reset-otp-input" data-index="5">
                            </div>
                        </div>

                        <div>
                            <label for="newPassword"
                                class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                                <i class="fas fa-lock mr-2"></i>New Password
                            </label>
                            <input type="password" id="newPassword" name="newPassword" required
                                class="input-glow w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl focus:outline-none transition-all duration-300 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                                placeholder="Enter new password (min 6 characters)">
                        </div>

                        <div>
                            <label for="confirmNewPassword"
                                class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                                <i class="fas fa-lock mr-2"></i>Confirm New Password
                            </label>
                            <input type="password" id="confirmNewPassword" name="confirmNewPassword" required
                                class="input-glow w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl focus:outline-none transition-all duration-300 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                                placeholder="Confirm your new password">
                        </div>

                        <div id="passwordResetOtpError"
                            class="hidden bg-red-100 dark:bg-red-900 border border-red-400 dark:border-red-600 text-red-700 dark:text-red-300 px-4 py-3 rounded-xl text-center">
                        </div>

                        <button type="submit" id="passwordResetOtpSubmit"
                            class="btn-primary w-full text-white py-3 rounded-xl font-semibold text-lg">
                            <span id="passwordResetOtpButtonText">
                                <i class="fas fa-check-circle mr-2"></i>Reset Password
                            </span>
                            <span id="passwordResetOtpButtonSpinner" class="hidden">
                                <div class="loading-spinner inline-block mr-2"></div>
                                Resetting...
                            </span>
                        </button>
                    </form>

                    <div class="mt-6 text-center">
                        <p class="text-gray-600 dark:text-gray-400 mb-3">Didn't receive the code?</p>
                        <button id="resendResetOtp"
                            class="text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 font-semibold transition-colors duration-300">
                            <span id="resendResetOtpText">
                                <i class="fas fa-redo mr-2"></i>Resend Code
                            </span>
                            <span id="resendResetOtpSpinner" class="hidden">
                                <div class="loading-spinner inline-block mr-2"></div>
                                Sending...
                            </span>
                        </button>
                    </div>
                </div>

                <!-- Password Reset Success Modal (NEW) -->
                <div id="passwordResetSuccess"
                    class="glass-effect p-8 rounded-2xl animate-fade-in-up hidden text-center">
                    <div
                        class="mx-auto h-20 w-20 bg-green-100 dark:bg-green-900 rounded-full flex items-center justify-center mb-6">
                        <i class="fas fa-check-circle text-3xl text-green-600 dark:text-green-400"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800 dark:text-white mb-4">Password Reset Successfully!</h3>
                    <p class="text-gray-600 dark:text-gray-300 mb-6">
                        Your password has been changed. You can now login with your new password.
                    </p>
                    <button id="goToLoginFromSuccess" class="btn-primary px-8 py-3 rounded-xl font-semibold text-lg">
                        <i class="fas fa-sign-in-alt mr-2"></i>
                        Go to Login
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Application state
        let currentUserEmail = '';

        // API Base URL
        const API_BASE_URL = '/api';

        // Theme Management
        function initializeTheme() {
            const themeToggle = document.getElementById('themeToggle');
            const mobileThemeToggle = document.getElementById('mobileThemeToggle');
            const themeIcon = document.getElementById('themeIcon');
            const mobileThemeIcon = document.getElementById('mobileThemeIcon');
            const html = document.documentElement;

            let currentTheme = localStorage.getItem('theme') || 'light';
            applyTheme(currentTheme);

            [themeToggle, mobileThemeToggle].forEach(toggle => {
                if (toggle) {
                    toggle.addEventListener('click', () => {
                        currentTheme = currentTheme === 'light' ? 'dark' : 'light';
                        applyTheme(currentTheme);
                        localStorage.setItem('theme', currentTheme);
                    });
                }
            });

            function applyTheme(theme) {
                if (theme === 'dark') {
                    html.classList.add('dark');
                    [themeIcon, mobileThemeIcon].forEach(icon => {
                        if (icon) icon.className = 'fas fa-sun text-xl';
                    });
                } else {
                    html.classList.remove('dark');
                    [themeIcon, mobileThemeIcon].forEach(icon => {
                        if (icon) icon.className = 'fas fa-moon text-xl';
                    });
                }
            }
        }

        // Form Management
        // Form Management
        function showForm(formId) {
            const forms = [
                'loginForm',
                'registerForm',
                'otpModal',
                'successMessage',
                'forgotPasswordForm',
                'passwordResetOtpModal',
                'passwordResetSuccess'
            ];
            forms.forEach(id => {
                document.getElementById(id).classList.add('hidden');
            });
            document.getElementById(formId).classList.remove('hidden');
        }

        // Error Management
        function showError(elementId, message) {
            const errorElement = document.getElementById(elementId);
            errorElement.textContent = message;
            errorElement.classList.remove('hidden');
        }

        function hideError(elementId) {
            document.getElementById(elementId).classList.add('hidden');
        }

        function showSuccess(elementId, message) {
            const successElement = document.getElementById(elementId);
            successElement.textContent = message;
            successElement.classList.remove('hidden');
        }

        function hideSuccess(elementId) {
            document.getElementById(elementId).classList.add('hidden');
        }

        // Loading State Management
        function setButtonLoading(buttonId, textElementId, spinnerElementId, isLoading = true) {
            const button = document.getElementById(buttonId);
            const textElement = document.getElementById(textElementId);
            const spinnerElement = document.getElementById(spinnerElementId);

            if (isLoading) {
                button.disabled = true;
                textElement.classList.add('hidden');
                spinnerElement.classList.remove('hidden');
            } else {
                button.disabled = false;
                textElement.classList.remove('hidden');
                spinnerElement.classList.add('hidden');
            }
        }

        // OTP Input Management
        function setupOTPInputs() {
            const inputs = document.querySelectorAll('.otp-input');

            inputs.forEach((input, index) => {
                input.addEventListener('input', (e) => {
                    const value = e.target.value;
                    if (value && index < inputs.length - 1) {
                        inputs[index + 1].focus();
                    }
                });

                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Backspace' && !e.target.value && index > 0) {
                        inputs[index - 1].focus();
                    }
                });

                input.addEventListener('paste', (e) => {
                    e.preventDefault();
                    const paste = (e.clipboardData || window.clipboardData).getData('text');
                    const pasteData = paste.slice(0, 6).split('');

                    pasteData.forEach((char, i) => {
                        if (inputs[i] && /\d/.test(char)) {
                            inputs[i].value = char;
                        }
                    });

                    if (pasteData.length > 0) {
                        const nextIndex = Math.min(pasteData.length, inputs.length - 1);
                        inputs[nextIndex].focus();
                    }
                });
            });
        }

        function getOTPValue() {
            const inputs = document.querySelectorAll('.otp-input');
            return Array.from(inputs).map(input => input.value).join('');
        }

        function clearOTPInputs() {
            const inputs = document.querySelectorAll('.otp-input');
            inputs.forEach(input => input.value = '');
            inputs[0].focus();
        }

        // API Calls
        // API Calls with timeout
        async function makeAPICall(endpoint, options = {}) {
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 10000); // 10 second timeout

                const response = await fetch(`${API_BASE_URL}${endpoint}`, {
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    signal: controller.signal,
                    ...options
                });

                clearTimeout(timeoutId);

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.message || `HTTP error! status: ${response.status}`);
                }

                return data;
            } catch (error) {
                if (error.name === 'AbortError') {
                    throw new Error('Request timeout. Please check your connection and try again.');
                }
                console.error('API call error:', error);
                throw error;
            }
        }

        // Authentication Functions
        async function handleLogin(email, password) {
            try {
                setButtonLoading('loginSubmit', 'loginButtonText', 'loginButtonSpinner', true);
                hideError('loginError');

                const response = await makeAPICall('/auth/login', {
                    method: 'POST',
                    body: JSON.stringify({ email, password })
                });

                if (response.requiresVerification) {
                    currentUserEmail = email;
                    showForm('otpModal');
                    document.getElementById('otpEmailDisplay').textContent = email;
                    clearOTPInputs();
                } else if (response.success && response.token) {
                    localStorage.setItem('authToken', response.token);
                    localStorage.setItem('currentUser', JSON.stringify(response.user));
                    // --- ADMIN REDIRECT LOGIC ---
                if (response.user.role === 'admin') {
                    console.log("Admin user detected, redirecting to admin dashboard.");
                    showForm('successMessage'); // Optionally show success before redirect
                    document.querySelector('#successMessage p').textContent = 'Login successful! Redirecting to Admin Dashboard...';
                    setTimeout(() => {
                        window.location.href = 'admin_dashboard.html'; // Redirect to admin page
                    }, 1500);
                } else {
                    console.log("Regular user detected, redirecting to user dashboard.");
                    showForm('successMessage');
                    document.querySelector('#successMessage p').textContent = 'Login successful! Redirecting to Dashboard...';
                    setTimeout(() => {
                        window.location.href = 'dashboard.html'; // Redirect to regular user page
                    }, 1500);
                }

                    showForm('successMessage');
                    setTimeout(() => {
                        window.location.href = 'dashboard.html';
                    }, 2000);
                }
                else {
                 // Handle cases where login might succeed but not return expected data
                 throw new Error(response.message || 'Login failed or unexpected response.');
            }

            } catch (error) {
                showError('loginError', error.message);
            } finally {
                setButtonLoading('loginSubmit', 'loginButtonText', 'loginButtonSpinner', false);
            }
        }

        async function handleRegister(username, email, password) {
            try {
                setButtonLoading('registerSubmit', 'registerButtonText', 'registerButtonSpinner', true);
                hideError('registerError');

                const response = await makeAPICall('/auth/register', {
                    method: 'POST',
                    body: JSON.stringify({ username, email, password })
                });

                if (response.requiresVerification) {
                    currentUserEmail = email;
                    showForm('otpModal');
                    document.getElementById('otpEmailDisplay').textContent = email;
                    clearOTPInputs();
                }

            } catch (error) {
                showError('registerError', error.message);
            } finally {
                setButtonLoading('registerSubmit', 'registerButtonText', 'registerButtonSpinner', false);
            }
        }

        async function handleOTPVerification(email, otp) {
            try {
                setButtonLoading('otpSubmit', 'otpButtonText', 'otpButtonSpinner', true);
                hideError('otpError');

                const response = await makeAPICall('/auth/verify-otp', {
                    method: 'POST',
                    body: JSON.stringify({ email, otp })
                });

                if (response.success && response.token) {
                    localStorage.setItem('authToken', response.token);
                    localStorage.setItem('currentUser', JSON.stringify(response.user));

                    showForm('successMessage');
                    setTimeout(() => {
                        window.location.href = 'dashboard.html';
                    }, 2000);
                }

            } catch (error) {
                showError('otpError', error.message);
                clearOTPInputs();
            } finally {
                setButtonLoading('otpSubmit', 'otpButtonText', 'otpButtonSpinner', false);
            }
        }

        async function handleResendOTP(email) {
            try {
                setButtonLoading('resendOtp', 'resendOtpText', 'resendOtpSpinner', true);
                hideError('otpError');

                await makeAPICall('/auth/resend-otp', {
                    method: 'POST',
                    body: JSON.stringify({ email })
                });

                clearOTPInputs();
                alert('New verification code sent to your email!');

            } catch (error) {
                showError('otpError', error.message);
            } finally {
                setButtonLoading('resendOtp', 'resendOtpText', 'resendOtpSpinner', false);
            }
        }

        async function handleForgotPassword(email) {
            try {
                setButtonLoading('forgotPasswordSubmit', 'forgotPasswordButtonText', 'forgotPasswordButtonSpinner', true);
                hideError('forgotPasswordError');
                hideSuccess('forgotPasswordSuccess');

                const response = await makeAPICall('/auth/forgot-password', {
                    method: 'POST',
                    body: JSON.stringify({ email })
                });

                if (response.success) {
                    showSuccess('forgotPasswordSuccess', response.message || 'Reset code sent to your email!');
                    setTimeout(() => {
                        showForm('loginForm');
                    }, 3000);
                }

            } catch (error) {
                showError('forgotPasswordError', error.message);
            } finally {
                setButtonLoading('forgotPasswordSubmit', 'forgotPasswordButtonText', 'forgotPasswordButtonSpinner', false);
            }
        }

        // Store reset email
        let resetPasswordEmail = '';

        // Setup Reset OTP Inputs
        function setupResetOTPInputs() {
            const inputs = document.querySelectorAll('.reset-otp-input');

            inputs.forEach((input, index) => {
                input.addEventListener('input', (e) => {
                    const value = e.target.value;
                    if (value && index < inputs.length - 1) {
                        inputs[index + 1].focus();
                    }
                });

                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Backspace' && !e.target.value && index > 0) {
                        inputs[index - 1].focus();
                    }
                });

                input.addEventListener('paste', (e) => {
                    e.preventDefault();
                    const paste = (e.clipboardData || window.clipboardData).getData('text');
                    const pasteData = paste.slice(0, 6).split('');

                    pasteData.forEach((char, i) => {
                        if (inputs[i] && /\d/.test(char)) {
                            inputs[i].value = char;
                        }
                    });

                    if (pasteData.length > 0) {
                        const nextIndex = Math.min(pasteData.length, inputs.length - 1);
                        inputs[nextIndex].focus();
                    }
                });
            });
        }

        function getResetOTPValue() {
            const inputs = document.querySelectorAll('.reset-otp-input');
            return Array.from(inputs).map(input => input.value).join('');
        }

        function clearResetOTPInputs() {
            const inputs = document.querySelectorAll('.reset-otp-input');
            inputs.forEach(input => input.value = '');
            inputs[0].focus();
        }

        // Updated forgot password handler
        async function handleForgotPassword(email) {
            try {
                setButtonLoading('forgotPasswordSubmit', 'forgotPasswordButtonText', 'forgotPasswordButtonSpinner', true);
                hideError('forgotPasswordError');
                hideSuccess('forgotPasswordSuccess');

                const response = await makeAPICall('/auth/forgot-password', {
                    method: 'POST',
                    body: JSON.stringify({ email })
                });

                if (response.success) {
                    resetPasswordEmail = email;
                    showForm('passwordResetOtpModal');
                    document.getElementById('resetOtpEmailDisplay').textContent = email;
                    clearResetOTPInputs();
                    setupResetOTPInputs();
                }

            } catch (error) {
                showError('forgotPasswordError', error.message);
            } finally {
                setButtonLoading('forgotPasswordSubmit', 'forgotPasswordButtonText', 'forgotPasswordButtonSpinner', false);
            }
        }

        // Handle password reset with OTP
        async function handlePasswordReset(email, otp, newPassword) {
            try {
                setButtonLoading('passwordResetOtpSubmit', 'passwordResetOtpButtonText', 'passwordResetOtpButtonSpinner', true);
                hideError('passwordResetOtpError');

                const response = await makeAPICall('/auth/reset-password', {
                    method: 'POST',
                    body: JSON.stringify({ email, otp, newPassword })
                });

                if (response.success) {
                    showForm('passwordResetSuccess');
                    resetPasswordEmail = '';
                }

            } catch (error) {
                showError('passwordResetOtpError', error.message);
                clearResetOTPInputs();
            } finally {
                setButtonLoading('passwordResetOtpSubmit', 'passwordResetOtpButtonText', 'passwordResetOtpButtonSpinner', false);
            }
        }

        // Resend reset OTP
        async function handleResendResetOTP(email) {
            try {
                setButtonLoading('resendResetOtp', 'resendResetOtpText', 'resendResetOtpSpinner', true);
                hideError('passwordResetOtpError');

                await makeAPICall('/auth/forgot-password', {
                    method: 'POST',
                    body: JSON.stringify({ email })
                });

                clearResetOTPInputs();
                alert('New reset code sent to your email!');

            } catch (error) {
                showError('passwordResetOtpError', error.message);
            } finally {
                setButtonLoading('resendResetOtp', 'resendResetOtpText', 'resendResetOtpSpinner', false);
            }
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', function () {
            // Initialize theme
            initializeTheme();

            // Setup OTP inputs
            setupOTPInputs();
            setupResetOTPInputs(); // Add this line

            // Check if already authenticated
            const token = localStorage.getItem('authToken');
            if (token) {
                window.location.href = 'dashboard.html';
                return;
            }

            // Form switch buttons
            document.getElementById('switchToRegister').addEventListener('click', () => {
                showForm('registerForm');
                hideError('loginError');
            });

            document.getElementById('switchToLogin').addEventListener('click', () => {
                showForm('loginForm');
                hideError('registerError');
            });

            document.getElementById('forgotPasswordBtn').addEventListener('click', () => {
                showForm('forgotPasswordForm');
                hideError('loginError');
            });

            document.getElementById('backToLogin').addEventListener('click', () => {
                showForm('loginForm');
                hideError('forgotPasswordError');
                hideSuccess('forgotPasswordSuccess');
            });

            // Login form
            document.getElementById('loginFormSubmit').addEventListener('submit', async (e) => {
                e.preventDefault();
                const formData = new FormData(e.target);
                const email = formData.get('email');
                const password = formData.get('password');

                if (!email || !password) {
                    showError('loginError', 'Please fill in all fields');
                    return;
                }

                await handleLogin(email, password);
            });

            // Register form
            document.getElementById('registerFormSubmit').addEventListener('submit', async (e) => {
                e.preventDefault();
                const formData = new FormData(e.target);
                const username = formData.get('username');
                const email = formData.get('email');
                const password = formData.get('password');

                if (!username || !email || !password) {
                    showError('registerError', 'Please fill in all fields');
                    return;
                }

                if (username.length < 3) {
                    showError('registerError', 'Username must be at least 3 characters long');
                    return;
                }

                if (password.length < 6) {
                    showError('registerError', 'Password must be at least 6 characters long');
                    return;
                }

                await handleRegister(username, email, password);
            });

            // OTP verification form
            document.getElementById('otpFormSubmit').addEventListener('submit', async (e) => {
                e.preventDefault();
                const otp = getOTPValue();

                if (otp.length !== 6) {
                    showError('otpError', 'Please enter the complete 6-digit code');
                    return;
                }

                await handleOTPVerification(currentUserEmail, otp);
            });

            // Resend OTP
            document.getElementById('resendOtp').addEventListener('click', async () => {
                await handleResendOTP(currentUserEmail);
            });

            // Forgot password form
            document.getElementById('forgotPasswordFormSubmit').addEventListener('submit', async (e) => {
                e.preventDefault();
                const formData = new FormData(e.target);
                const email = formData.get('email');

                if (!email) {
                    showError('forgotPasswordError', 'Please enter your email address');
                    return;
                }

                await handleForgotPassword(email);
            });

            // Forgot password form
            document.getElementById('forgotPasswordFormSubmit').addEventListener('submit', async (e) => {
                e.preventDefault();
                const formData = new FormData(e.target);
                const email = formData.get('email');

                if (!email) {
                    showError('forgotPasswordError', 'Please enter your email address');
                    return;
                }

                await handleForgotPassword(email);
            });

            // Password reset OTP form
            document.getElementById('passwordResetOtpFormSubmit').addEventListener('submit', async (e) => {
                e.preventDefault();
                const otp = getResetOTPValue();
                const newPassword = document.getElementById('newPassword').value;
                const confirmPassword = document.getElementById('confirmNewPassword').value;

                if (otp.length !== 6) {
                    showError('passwordResetOtpError', 'Please enter the complete 6-digit code');
                    return;
                }

                if (!newPassword || newPassword.length < 6) {
                    showError('passwordResetOtpError', 'Password must be at least 6 characters long');
                    return;
                }

                if (newPassword !== confirmPassword) {
                    showError('passwordResetOtpError', 'Passwords do not match');
                    return;
                }

                await handlePasswordReset(resetPasswordEmail, otp, newPassword);
            });

            // Resend reset OTP
            document.getElementById('resendResetOtp').addEventListener('click', async () => {
                await handleResendResetOTP(resetPasswordEmail);
            });

            // Go to login from success
            document.getElementById('goToLoginFromSuccess').addEventListener('click', () => {
                showForm('loginForm');
                // Clear the form
                document.getElementById('loginFormSubmit').reset();
            });
        });
    </script>
</body>

</html>